<p-dialog #dialog [visible]="visible" [modal]="false" [closable]="false" [style]="dialogStyle"
    [styleClass]="fullscreen ? 'dialog-fullscreen' : ''" [ngClass]="dialogClass" [maximizable]="false"
    (onHide)="closeDialog()" (onShow)="onDialogShow()" [draggable]="!fullscreen" [resizable]="!fullscreen">

    <!-- Header -->
    <ng-template pTemplate="header">
        <div class="dialog-header-custom">
            <span class="header-title">{{ name }} - İşlem Detay Yönetim</span>
            <div class="header-actions">
                <div class="window-btn" (click)="toggleMinimize()" pTooltip="Küçült" tooltipPosition="bottom">
                    <i class="pi pi-minus"></i>
                </div>
                <div class="window-btn" (click)="toggleFullscreen()"
                    [pTooltip]="fullscreen ? 'Eski Boyut' : 'Tam Ekran'" tooltipPosition="bottom">
                    <i [class]="fullscreen ? 'pi pi-clone' : 'pi pi-window-maximize'"></i>
                </div>
                <div class="window-btn close-btn" (click)="closeDialog()" pTooltip="Kapat" tooltipPosition="bottom">
                    <i class="pi pi-times"></i>
                </div>
            </div>
        </div>
    </ng-template>

    <!-- İçerik (Minimize değilse göster) -->
    <div *ngIf="!minimized" class="dialog-content-wrapper">

        <!-- Üst Toolbar / Filtre -->
        <div class="top-toolbar">
            <div class="search-group">
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input type="text" pInputText [(ngModel)]="searchBasvuruNo" placeholder="Başvuru No"
                        class="p-inputtext-sm" />
                </span>
                <button pButton icon="pi pi-search" class="p-button-outlined p-button-secondary p-button-sm"></button>
            </div>

            <div class="toolbar-right-actions">
                <button pButton icon="pi pi-filter" class="p-button-text p-button-secondary p-button-sm"
                    pTooltip="Belge Önizleme"></button>
                <button pButton icon="pi pi-database" class="p-button-text p-button-secondary p-button-sm"
                    pTooltip="Veri Havuzu Yönetimi"></button>
                <button pButton icon="pi pi-refresh" class="p-button-text p-button-secondary p-button-sm"
                    pTooltip="Yenile"></button>
                <button pButton icon="pi pi-save" class="p-button-text p-button-secondary p-button-sm"
                    pTooltip="Kaydet"></button>
            </div>
        </div>

        <!-- 4 Panelli Splitter Yapısı -->
        <div class="splitter-container">
            <p-splitter [style]="{'height': '100%'}" [panelSizes]="[15, 25, 25, 35]" layout="horizontal">

                <!-- 1. Panel: İşlemler ve Belgeler (Flexbox Yapı - Sabit Alt Panel) -->
                <ng-template pTemplate>
                    <div style="height: 100%; width: 100%; display: flex; flex-direction: column; overflow: hidden;">

                        <!-- Üst: İşlemler Listesi (%60) -->
                        <div style="flex: 60; overflow: hidden; display: flex; flex-direction: column;">
                            <div class="panel-content" style="height: 100%; border-bottom: none; border-radius: 0;">
                                <div class="panel-header">
                                    <span>İşlemler</span>
                                    <i class="pi pi-filter panel-icon"></i>
                                </div>
                                <div class="panel-body">
                                    <!-- İşlem Listesi (Örnek) -->
                                    <div class="empty-state">
                                        <span>İşlem Seçiniz</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alt: Belge Önizleme (%40) -->
                        <div style="flex: 40; min-height: 0; display: flex; flex-direction: column;">
                            <div class="panel-content"
                                style="height: 100%; border-top: 1px solid #cce3f8; border-radius: 0;">
                                <div class="panel-header">
                                    <span>Belge Önizleme</span>
                                    <i class="pi pi-eye"></i>
                                </div>
                                <div class="panel-body centered-text">
                                    <span>İşlem Seçiniz</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </ng-template>

                <!-- 2. Panel: Parseller -->
                <ng-template pTemplate>
                    <div class="panel-content">
                        <div class="panel-header">
                            <span>Parseller</span>
                            <div class="header-icons">
                                <i class="pi pi-share-alt"></i>
                                <i class="pi pi-expand"></i>
                                <i class="pi pi-sliders-h"></i>
                            </div>
                        </div>
                        <div class="panel-body centered-text">
                            <span>İşlem Seçiniz</span>
                        </div>
                    </div>
                </ng-template>

                <!-- 3. Panel: Seçili Parsel Meta Data -->
                <ng-template pTemplate>
                    <div class="panel-content">
                        <div class="panel-header">
                            <span>Seçili Parsel Meta Data</span>
                        </div>
                        <div class="panel-body centered-text">
                            <span>İşlem Seçiniz</span>
                        </div>
                    </div>
                </ng-template>

                <!-- 4. Panel: Harita -->
                <ng-template pTemplate>
                    <div class="panel-content">
                        <div class="panel-header">
                            <span>Harita</span>
                            <div class="header-icons">
                                <i class="pi pi-map" (click)="op.toggle($event)" style="cursor: pointer;"
                                    pTooltip="Harita Altlığını Değiştir"></i>

                                <!-- Harita Altlık Seçim Menüsü -->
                                <p-overlayPanel #op styleClass="map-layer-overlay">
                                    <ng-template pTemplate>
                                        <div class="radio-group-container">
                                            <label *ngFor="let option of baseLayerOptions; let i = index"
                                                class="radio-label">
                                                <input type="radio" name="fenBaseLayer" class="radio-input"
                                                    [value]="option.value" [(ngModel)]="selectedBaseLayer"
                                                    (change)="changeBaseLayer(option.value)" />
                                                <span class="radio-custom"></span>
                                                <span class="radio-text">{{ option.label }}</span>
                                            </label>
                                        </div>
                                    </ng-template>
                                </p-overlayPanel>
                            </div>

                        </div>
                        <div class="panel-body no-padding" style="position: relative;">
                            <div id="fen-map" style="width: 100%; height: 100%; z-index: 1;"></div>
                        </div>
                    </div>
                </ng-template>

            </p-splitter>
        </div>

        <!-- Footer / Status Bar -->
        <div class="footer-status">
            <i class="pi pi-chevron-right"></i>
            <span>İşlem Detay Yönetim</span>
        </div>
    </div>
</p-dialog>